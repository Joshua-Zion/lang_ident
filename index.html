<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastText å®æ—¶è¯­ç§æ£€æµ‹å™¨</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—ä½“ */
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

    <!-- ä¸»å®¹å™¨ -->
    <div class="w-full max-w-3xl bg-white shadow-2xl shadow-indigo-200/50 rounded-2xl p-6 sm:p-10 space-y-6">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700">
            ğŸŒ å®æ—¶è¯­ç§æ£€æµ‹å™¨
        </h1>
        <p class="text-center text-gray-500 text-sm">
            ä½¿ç”¨ FastText æ¨¡å‹è¿›è¡Œå³æ—¶è¯­è¨€è¯†åˆ«ã€‚è¯·åœ¨ä¸‹æ–¹é€‰æ‹©æ¨¡å‹å¹¶è¾“å…¥æ–‡æœ¬ã€‚
        </p>

        <!-- æ¨¡å‹é€‰æ‹©å’Œè¾“å…¥åŒº -->
        <div class="space-y-4 p-4 border border-gray-200 rounded-xl bg-gray-50">
            <!-- æ¨¡å‹é€‰æ‹© -->
            <label for="modelSelect" class="block text-sm font-medium text-gray-700">é€‰æ‹©æ£€æµ‹æ¨¡å‹ï¼š</label>
            <select id="modelSelect" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                <option value="lid.176.bin">å®˜æ–¹ 176 è¯­ç§æ¨¡å‹ (.bin)</option>
                <option value="lid.176.ftz">å®˜æ–¹ 176 è¯­ç§æ¨¡å‹ (å‹ç¼© .ftz)</option>
            </select>

            <!-- æ–‡æœ¬è¾“å…¥åŒº -->
            <label for="textInput" class="block text-sm font-medium text-gray-700 pt-2">è¾“å…¥å¾…æ£€æµ‹æ–‡æœ¬ï¼š</label>
            <textarea id="textInput"
                      rows="4"
                      class="w-full p-4 border-2 border-indigo-300 rounded-lg shadow-inner focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 resize-none text-base"
                      placeholder="è¯·è¾“å…¥å¾…æ£€æµ‹çš„æ–‡æœ¬..."></textarea>
        </div>

        <!-- ç»“æœæ˜¾ç¤ºåŒº -->
        <div id="resultBox" class="p-6 bg-indigo-50 border border-indigo-300 rounded-xl min-h-[140px] flex flex-col justify-center transition-all duration-300">
            <h2 class="text-xl font-bold text-indigo-800 mb-2 border-b border-indigo-300 pb-2">ğŸ¯ æ£€æµ‹ç»“æœ</h2>
            <div id="predictionContent">
                <p class="text-gray-600 text-lg italic">ç­‰å¾…è¾“å…¥...</p>
            </div>
            <div id="loadingIndicator" class="hidden text-center py-4">
                <div class="animate-spin inline-block w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full"></div>
                <span class="ml-3 text-indigo-500 font-medium">æ­£åœ¨ä½¿ç”¨æ‰€é€‰æ¨¡å‹è¿›è¡Œæ£€æµ‹...</span>
            </div>
        </div>

        <!-- é”™è¯¯æç¤ºåŒº -->
        <div id="errorBox" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
            <strong class="font-bold">âš ï¸ é”™è¯¯:</strong>
            <span id="errorMessage" class="block sm:inline ml-2"></span>
        </div>
    </div>

    <script>
        // æ˜ å°„ç”¨æˆ·æä¾›çš„è¯­è¨€ä»£ç åˆ°ä¸­æ–‡åç§°
        const LANGUAGE_MAP = {
            'af': 'å—éè¯­', 'als': 'é˜¿å°”è¨æ–¯è¯­', 'am': 'é˜¿å§†å“ˆæ‹‰è¯­', 'an': 'é˜¿æ‹‰è´¡è¯­',
            'ar': 'é˜¿æ‹‰ä¼¯è¯­', 'arz': 'åŸƒåŠé˜¿æ‹‰ä¼¯è¯­', 'as': 'é˜¿è¨å§†è¯­', 'ast': 'é˜¿æ–¯å›¾é‡Œäºšæ–¯è¯­',
            'av': 'é˜¿ç“¦å°”è¯­', 'az': 'é˜¿å¡æ‹œç–†è¯­', 'azb': 'å—é˜¿å¡æ‹œç–†è¯­', 'ba': 'å·´ä»€åŸºå°”è¯­',
            'bar': 'å·´ä¼åˆ©äºšè¯­', 'bcl': 'ä¸­éƒ¨æ¯”ç§‘å°”è¯­', 'be': 'ç™½ä¿„ç½—æ–¯è¯­', 'bg': 'ä¿åŠ åˆ©äºšè¯­',
            'bh': 'æ¯”å“ˆå°”è¯­', 'bn': 'å­ŸåŠ æ‹‰è¯­', 'bo': 'è—è¯­', 'bpy': 'æ¯”ä»€å¥´æ™®é‡Œäºš-æ›¼å°¼æ™®å°”è¯­',
            'br': 'å¸ƒåˆ—å¡”å°¼è¯­', 'bs': 'æ³¢æ–¯å°¼äºšè¯­', 'bxr': 'å¸ƒé‡Œäºšç‰¹è¯­', 'ca': 'åŠ æ³°ç½—å°¼äºšè¯­',
            'cbk': 'æŸ¥ç“¦å¡è¯ºè¯­', 'ce': 'è½¦è‡£è¯­', 'ceb': 'å®¿é›¾è¯­', 'ckb': 'ä¸­åº“å°”å¾·è¯­',
            'co': 'ç§‘è¥¿å˜‰è¯­', 'cs': 'æ·å…‹è¯­', 'cv': 'æ¥šç“¦ä»€è¯­', 'cy': 'å¨å°”å£«è¯­',
            'da': 'ä¸¹éº¦è¯­', 'de': 'å¾·è¯­', 'diq': 'æ‰æ‰å…¶è¯­', 'dsb': 'ä½åœ°ç´¢å¸ƒè¯­',
            'dty': 'è¿ªå¥¥åˆ©è¯­', 'dv': 'é©¬å°”ä»£å¤«è¯­', 'el': 'å¸Œè…Šè¯­', 'eml': 'è‰¾ç±³åˆ©äºšè¯­',
            'en': 'è‹±è¯­', 'eo': 'ä¸–ç•Œè¯­', 'es': 'è¥¿ç­ç‰™è¯­', 'et': 'çˆ±æ²™å°¼äºšè¯­',
            'eu': 'å·´æ–¯å…‹è¯­', 'fa': 'æ³¢æ–¯è¯­', 'fi': 'èŠ¬å…°è¯­', 'fr': 'æ³•è¯­',
            'frr': 'åŒ—å¼—é‡Œæ–¯å…°è¯­', 'fy': 'è¥¿å¼—é‡Œæ–¯è¯­', 'ga': 'çˆ±å°”å…°è¯­', 'gd': 'è‹æ ¼å…°ç›–å°”è¯­',
            'gl': 'åŠ åˆ©è¥¿äºšè¯­', 'gn': 'ç“œæ‹‰å°¼è¯­', 'gom': 'æœé˜¿å­”å¡å°¼è¯­', 'gu': 'å¤å‰æ‹‰ç‰¹è¯­',
            'gv': 'é©¬æ©å²›è¯­', 'he': 'å¸Œä¼¯æ¥è¯­', 'hi': 'å°åœ°è¯­', 'hif': 'æ–æµå°åœ°è¯­',
            'hr': 'å…‹ç½—åœ°äºšè¯­', 'hsb': 'é«˜åœ°ç´¢å¸ƒè¯­', 'ht': 'æµ·åœ°å…‹é‡Œå¥¥å°”è¯­', 'hu': 'åŒˆç‰™åˆ©è¯­',
            'hy': 'äºšç¾å°¼äºšè¯­', 'ia': 'å›½é™…è¯­', 'id': 'å°å°¼è¯­', 'ie': 'å›½é™…è¯­',
            'ilo': 'ä¼Šæ´›å¡è¯ºè¯­', 'io': 'ä¼Šå¤šè¯­', 'is': 'å†°å²›è¯­', 'it': 'æ„å¤§åˆ©è¯­',
            'ja': 'æ—¥è¯­', 'jbo': 'é€»è¾‘è¯­', 'jv': 'çˆªå“‡è¯­', 'ka': 'æ ¼é²å‰äºšè¯­',
            'kk': 'å“ˆè¨å…‹è¯­', 'km': 'é«˜æ£‰è¯­', 'kn': 'å¡çº³è¾¾è¯­', 'ko': 'éŸ©è¯­',
            'krc': 'å¡æ‹‰æ°ä¼Š-å·´å°”å¡å°”è¯­', 'ku': 'åº“å°”å¾·è¯­', 'kv': 'ç§‘ç±³è¯­', 'kw': 'åº·æ²ƒå°”è¯­',
            'ky': 'å‰å°”å‰æ–¯è¯­', 'la': 'æ‹‰ä¸è¯­', 'lb': 'å¢æ£®å ¡è¯­', 'lez': 'åˆ—å…¹é‡‘è¯­',
            'li': 'æ—å ¡è¯­', 'lmo': 'ä¼¦å·´åº•è¯­', 'lo': 'è€æŒè¯­', 'lrc': 'åŒ—æ´›é›·æ–¯å¦è¯­',
            'lt': 'ç«‹é™¶å®›è¯­', 'lv': 'æ‹‰è„±ç»´äºšè¯­', 'mai': 'è¿ˆè’‚åˆ©è¯­', 'mg': 'é©¬æ‹‰åŠ æ–¯è¯­',
            'mhr': 'é©¬é‡Œè¯­', 'min': 'ç±³å—å¡å ¡è¯­', 'mk': 'é©¬å…¶é¡¿è¯­', 'ml': 'é©¬æ‹‰é›…æ‹‰å§†è¯­',
            'mn': 'è’™å¤è¯­', 'mr': 'é©¬æ‹‰åœ°è¯­', 'mrj': 'è¥¿é©¬é‡Œè¯­', 'ms': 'é©¬æ¥è¯­',
            'mt': 'é©¬è€³ä»–è¯­', 'mwl': 'ç±³å…°å¾·è¯­', 'my': 'ç¼…ç”¸è¯­', 'myv': 'è«å°”å¤šç“¦è¯­',
            'mzn': 'é©¬èµå¾·å…°è¯­', 'nah': 'çº³ç“¦ç‰¹å°”è¯­', 'nap': 'é‚£ä¸å‹’æ–¯è¯­', 'nds': 'ä½åœ°å¾·è¯­',
            'ne': 'å°¼æ³Šå°”è¯­', 'new': 'å°¼ç“¦å°”è¯­', 'nl': 'è·å…°è¯­', 'nn': 'æ–°æŒªå¨è¯­',
            'no': 'æŒªå¨è¯­', 'oc': 'å¥¥å…‹è¯­', 'or': 'å¥¥é‡Œäºšè¯­', 'os': 'å¥¥å¡æ¢¯è¯­',
            'pa': 'æ—é®æ™®è¯­', 'pam': 'é‚¦æ¿ç‰™è¯­', 'pfl': 'æ™®æ³•å°”èŒ¨å¾·è¯­', 'pl': 'æ³¢å…°è¯­',
            'pms': 'çš®åŸƒè’™ç‰¹è¯­', 'pnb': 'è¥¿æ—é®æ™®è¯­', 'ps': 'æ™®ä»€å›¾è¯­', 'pt': 'è‘¡è„ç‰™è¯­',
            'qu': 'å…‹ä¸˜äºšè¯­', 'rm': 'ç½—æ›¼ä»€è¯­', 'ro': 'ç½—é©¬å°¼äºšè¯­', 'ru': 'ä¿„è¯­',
            'rue': 'å¢æ£®å°¼äºšè¯­', 'sa': 'æ¢µè¯­', 'sah': 'é›…åº“ç‰¹è¯­', 'sc': 'æ’’ä¸è¯­',
            'scn': 'è¥¿è¥¿é‡Œè¯­', 'sco': 'è‹æ ¼å…°è¯­', 'sd': 'ä¿¡å¾·è¯­', 'sh': 'å¡å°”ç»´äºš-å…‹ç½—åœ°äºšè¯­',
            'si': 'åƒ§ä¼½ç½—è¯­', 'sk': 'æ–¯æ´›ä¼å…‹è¯­', 'sl': 'æ–¯æ´›æ–‡å°¼äºšè¯­', 'so': 'ç´¢é©¬é‡Œè¯­',
            'sq': 'é˜¿å°”å·´å°¼äºšè¯­', 'sr': 'å¡å°”ç»´äºšè¯­', 'su': 'å·½ä»–è¯­', 'sv': 'ç‘å…¸è¯­',
            'sw': 'æ–¯ç“¦å¸Œé‡Œè¯­', 'ta': 'æ³°ç±³å°”è¯­', 'te': 'æ³°å¢å›ºè¯­', 'tg': 'å¡”å‰å…‹è¯­',
            'th': 'æ³°è¯­', 'tk': 'åœŸåº“æ›¼è¯­', 'tl': 'ä»–åŠ ç¦„è¯­', 'tr': 'åœŸè€³å…¶è¯­',
            'tt': 'é‘é¼è¯­', 'tyv': 'å›¾ç“¦è¯­', 'ug': 'ç»´å¾å°”è¯­', 'uk': 'ä¹Œå…‹å…°è¯­',
            'ur': 'ä¹Œå°”éƒ½è¯­', 'uz': 'ä¹Œå…¹åˆ«å…‹è¯­', 'vec': 'å¨å°¼æ–¯è¯­', 'vep': 'ç»´æ™®æ–¯è¯­',
            'vi': 'è¶Šå—è¯­', 'vls': 'è¥¿å¼—æ‹‰èŠ’è¯­', 'vo': 'æ²ƒæ‹‰æ™®å…‹è¯­', 'wa': 'ç“¦éš†è¯­',
            'war': 'ç“¦ç‘è¯­', 'wuu': 'å´è¯­', 'xal': 'å¡å°”æ¢…å…‹è¯­', 'xmf': 'æ˜æ ¼é›·å°”è¯­',
            'yi': 'æ„ç¬¬ç»ªè¯­', 'yo': 'çº¦é²å·´è¯­', 'yue': 'ç²¤è¯­', 'zh': 'ä¸­æ–‡ (æ±‰è¯­)'
        };

        const API_URL = '/predict'; // Flask æ¥å£
        const textInput = document.getElementById('textInput');
        const modelSelect = document.getElementById('modelSelect'); // æ–°å¢æ¨¡å‹é€‰æ‹©å™¨å…ƒç´ 
        const predictionContent = document.getElementById('predictionContent');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorBox = document.getElementById('errorBox');
        const errorMessage = document.getElementById('errorMessage');
        let debounceTimer;

        /**
         * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
         * @param {string} message é”™è¯¯å†…å®¹
         */
        function showError(message) {
            errorBox.classList.remove('hidden');
            errorMessage.textContent = message;
        }

        /**
         * éšè—é”™è¯¯ä¿¡æ¯
         */
        function hideError() {
            errorBox.classList.add('hidden');
        }

        /**
         * è·å–è¯­è¨€çš„ä¸­æ–‡åç§°
         * @param {string} code è¯­è¨€ä»£ç  (å¦‚ 'en')
         * @returns {string} ä¸­æ–‡åç§°æˆ–ä»£ç æœ¬èº«
         */
        function getChineseName(code) {
            return LANGUAGE_MAP[code] || `æœªçŸ¥è¯­è¨€ (${code})`;
        }

        /**
         * æ‰§è¡Œè¯­ç§æ£€æµ‹è¯·æ±‚
         * @param {string} text å¾…æ£€æµ‹æ–‡æœ¬
         * @param {string} modelName é€‰å®šçš„æ¨¡å‹åç§°
         */
        async function detectLanguage(text, modelName) {
            hideError();
            loadingIndicator.classList.remove('hidden');
            predictionContent.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹

            if (text.trim().length === 0) {
                loadingIndicator.classList.add('hidden');
                predictionContent.innerHTML = '<p class="text-gray-600 text-lg italic">ç­‰å¾…è¾“å…¥...</p>';
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        model_name: modelName // å‘é€é€‰å®šçš„æ¨¡å‹åç§°åˆ°åç«¯
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const langName = getChineseName(data.lang_code);
                    predictionContent.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <span class="text-4xl font-extrabold text-indigo-700">${langName}</span>
                            <span class="text-xl text-gray-500 bg-gray-200 px-2 py-1 rounded-md">(${data.lang_code})</span>
                        </div>
                        <span class="block text-base text-gray-700 mt-2">
                            ç½®ä¿¡åº¦:
                            <span class="font-mono font-semibold text-green-600">${data.confidence}</span>
                        </span>
                        <span class="block text-xs text-gray-400 mt-1">ä½¿ç”¨æ¨¡å‹: ${modelName}</span>
                    `;
                } else {
                    // å¤„ç†åç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯
                    showError(data.error || `æ£€æµ‹å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
                    predictionContent.innerHTML = '<p class="text-gray-600 text-lg italic">æ£€æµ‹å¤±è´¥ã€‚</p>';
                }

            } catch (e) {
                // å¤„ç†ç½‘ç»œæˆ–è§£æé”™è¯¯
                showError(`ç½‘ç»œè¿æ¥é”™è¯¯æˆ–æœåŠ¡å™¨æ— å“åº”: ${e.message}`);
                predictionContent.innerHTML = '<p class="text-gray-600 text-lg italic">æ£€æµ‹å¤±è´¥ã€‚</p>';
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // --- äº‹ä»¶å¤„ç†å™¨ ---
        function handleInput() {
            const text = textInput.value;
            const modelName = modelSelect.value;

            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            clearTimeout(debounceTimer);

            // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼š500æ¯«ç§’åæ‰§è¡Œæ£€æµ‹
            debounceTimer = setTimeout(() => {
                detectLanguage(text, modelName);
            }, 500);
        }

        // --- äº‹ä»¶ç›‘å¬å™¨ï¼šæ–‡æœ¬è¾“å…¥å’Œæ¨¡å‹é€‰æ‹©æ›´æ”¹éƒ½ä¼šè§¦å‘æ£€æµ‹ ---
        textInput.addEventListener('input', handleInput);
        modelSelect.addEventListener('change', handleInput);

        // åˆå§‹çŠ¶æ€è®¾ç½®
        window.onload = () => {
             predictionContent.innerHTML = '<p class="text-gray-600 text-lg italic">è¯·è¾“å…¥æ–‡æœ¬ä»¥å¼€å§‹æ£€æµ‹...</p>';
             // ç«‹å³æ‰§è¡Œä¸€æ¬¡æ£€æµ‹ï¼Œä»¥æ˜¾ç¤ºåˆå§‹çŠ¶æ€
             handleInput();
        };

    </script>
</body>
</html>